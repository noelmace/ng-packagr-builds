{"version":3,"file":"synthesized-source-file.js","sourceRoot":"","sources":["../../../src/lib/ts/synthesized-source-file.ts"],"names":[],"mappings":";;AAAA,iCAAiC;AAgBjC,iCAAwC,UAAyB;IAC/D,MAAM,CAAC,UAAU,IAAI,UAAU,CAAC,gBAAgB,CAAC,YAAY,KAAK,CAAC;AACrE,CAAC;AAFD,0DAEC;AAED;;;;;;GAMG;AACH,0CAAiD,IAAa,EAAE,WAAmB;IACjF,MAAM,UAAU,GAAG,IAAI,CAAC,aAAa,EAA2B,CAAC;IAEjE,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,CAAC;QAC/B,UAAU,CAAC,cAAc,GAAG,EAAE,CAAC;IACjC,CAAC;IAED,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC;QAC7B,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE;QACrB,EAAE,EAAE,IAAI,CAAC,MAAM,EAAE;QACjB,IAAI,EAAE,WAAW;KAClB,CAAC,CAAC;IAEH,MAAM,CAAC,UAAU,CAAC;AACpB,CAAC;AAdD,4EAcC;AAED;;;;GAIG;AACH,yBAAgC,UAAiD;IAC/E,MAAM,cAAc,GAAG,UAAU,CAAC,WAAW,EAAE,CAAC;IAEhD,EAAE,CAAC,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACxC,IAAI,SAAS,GAAG,EAAE,CAAC;QACnB,IAAI,QAAQ,GAAG,CAAC,CAAC;QACjB,GAAG,CAAC,CAAC,IAAI,WAAW,IAAI,UAAU,CAAC,cAAc,CAAC,CAAC,CAAC;YAClD,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,QAAQ,EAAE,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YAC5G,QAAQ,GAAG,WAAW,CAAC,EAAE,CAAC;QAC5B,CAAC;QACD,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;QAEjE,MAAM,CAAC,SAAS,CAAC;IACnB,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,MAAM,CAAC,cAAc,CAAC;IACxB,CAAC;AACH,CAAC;AAhBD,0CAgBC;AAED;;;;;GAKG;AACH,yBAAgC,UAAiD;IAC/E,EAAE,CAAC,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACxC,MAAM,UAAU,GAAG,eAAe,CAAC,UAAU,CAAC,CAAC;QAE/C,MAAM,CAAC,EAAE,CAAC,gBAAgB,CAAC,UAAU,CAAC,QAAQ,EAAE,UAAU,EAAE,UAAU,CAAC,eAAe,EAAE,IAAI,EAAE,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;IAClH,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,MAAM,CAAC,UAAU,CAAC;IACpB,CAAC;AACH,CAAC;AARD,0CAQC","sourcesContent":["import * as ts from 'typescript';\r\n\r\n/**\r\n * An extension to TypeScript source files that allows to replace text spands in the original\r\n * source text with synthesized source text.\r\n */\r\nexport interface SynthesizedSourceFile extends ts.SourceFile {\r\n  __replacements?: Replacement[];\r\n}\r\n\r\nexport interface Replacement {\r\n  from: number;\r\n  to: number;\r\n  text: string;\r\n}\r\n\r\nexport function isSynthesizedSourceFile(sourceFile: ts.SourceFile): sourceFile is SynthesizedSourceFile {\r\n  return sourceFile && sourceFile['__replacements'] instanceof Array;\r\n}\r\n\r\n/**\r\n * Adds a {@link Replacement} marker to the TypeScript source file of `node`. The source text of\r\n * `node` should be replaced by the `replacement` source text in subsequent processing.\r\n *\r\n * @param node The source node that should be replaced\r\n * @param replacement The synthesized source text that will replace the node.\r\n */\r\nexport function replaceWithSynthesizedSourceText(node: ts.Node, replacement: string): SynthesizedSourceFile {\r\n  const sourceFile = node.getSourceFile() as SynthesizedSourceFile;\r\n\r\n  if (!sourceFile.__replacements) {\r\n    sourceFile.__replacements = [];\r\n  }\r\n\r\n  sourceFile.__replacements.push({\r\n    from: node.getStart(),\r\n    to: node.getEnd(),\r\n    text: replacement\r\n  });\r\n\r\n  return sourceFile;\r\n}\r\n\r\n/**\r\n * Writes TypeScript source text to a string, potentially applying replacements.\r\n *\r\n * @param sourceFile TypeScript source file, either original or synthesiized sources\r\n */\r\nexport function writeSourceText(sourceFile: ts.SourceFile | SynthesizedSourceFile): string {\r\n  const originalSource = sourceFile.getFullText();\r\n\r\n  if (isSynthesizedSourceFile(sourceFile)) {\r\n    let newSource = '';\r\n    let position = 0;\r\n    for (let replacement of sourceFile.__replacements) {\r\n      newSource = newSource.concat(originalSource.substring(position, replacement.from)).concat(replacement.text);\r\n      position = replacement.to;\r\n    }\r\n    newSource = newSource.concat(originalSource.substring(position));\r\n\r\n    return newSource;\r\n  } else {\r\n    return originalSource;\r\n  }\r\n}\r\n\r\n/**\r\n * Writes a TypeScript source file, potentially applying replacements, and returns a 'fresh' source\r\n * file instance that may be used for later processing.\r\n *\r\n * @param sourceFile TypeScript source file, either original or synthesized sources\r\n */\r\nexport function writeSourceFile(sourceFile: ts.SourceFile | SynthesizedSourceFile): ts.SourceFile {\r\n  if (isSynthesizedSourceFile(sourceFile)) {\r\n    const sourceText = writeSourceText(sourceFile);\r\n\r\n    return ts.createSourceFile(sourceFile.fileName, sourceText, sourceFile.languageVersion, true, ts.ScriptKind.TS);\r\n  } else {\r\n    return sourceFile;\r\n  }\r\n}\r\n"]}