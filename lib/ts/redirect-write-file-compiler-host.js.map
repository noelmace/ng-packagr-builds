{"version":3,"file":"redirect-write-file-compiler-host.js","sourceRoot":"","sources":["../../../src/lib/ts/redirect-write-file-compiler-host.ts"],"names":[],"mappings":";;AAAA,+BAA+B;AAE/B,6BAA6B;AAE7B;;;;;;GAMG;AACH,uCACE,YAA6B,EAC7B,OAAe,EACf,cAAsB;IAEtB,MAAM,mBACD,YAAY,IACf,SAAS,EAAE,CACT,QAAgB,EAChB,IAAY,EACZ,kBAA2B,EAC3B,OAAmC,EACnC,WAA0C,EAC1C,EAAE;YACF,IAAI,QAAQ,GAAG,QAAQ,CAAC;YACxB,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBAC/B,MAAM,mBAAmB,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;gBAC7D,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE,mBAAmB,CAAC,CAAC;YAC/D,CAAC;YACD,EAAE,CAAC,cAAc,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACpC,CAAC,IACD;AACJ,CAAC;AAtBD,sEAsBC","sourcesContent":["import * as fs from 'fs-extra';\r\nimport * as ts from 'typescript';\r\nimport * as path from 'path';\r\n\r\n/**\r\n * Returns a TypeScript compiler host that redirects `writeFile` output to the given `declarationDir`.\r\n *\r\n * @param compilerHost Original compiler host\r\n * @param baseDir Project base directory\r\n * @param declarationDir Declarations target directory\r\n */\r\nexport function redirectWriteFileCompilerHost(\r\n  compilerHost: ts.CompilerHost,\r\n  baseDir: string,\r\n  declarationDir: string\r\n): ts.CompilerHost {\r\n  return {\r\n    ...compilerHost,\r\n    writeFile: (\r\n      fileName: string,\r\n      data: string,\r\n      writeByteOrderMark: boolean,\r\n      onError?: (message: string) => void,\r\n      sourceFiles?: ReadonlyArray<ts.SourceFile>\r\n    ) => {\r\n      let filePath = fileName;\r\n      if (fileName.endsWith('.d.ts')) {\r\n        const projectRelativePath = path.relative(baseDir, fileName);\r\n        filePath = path.resolve(declarationDir, projectRelativePath);\r\n      }\r\n      fs.outputFileSync(filePath, data);\r\n    }\r\n  };\r\n}\r\n"]}