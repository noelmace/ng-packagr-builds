{"version":3,"file":"transform-component.js","sourceRoot":"","sources":["../../../src/lib/ts/transform-component.ts"],"names":[],"mappings":";;AAAA,iCAAiC;AACjC,2CAA+E;AAgBlE,QAAA,kBAAkB,GAEa,WAAW,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE;IACjF,uEAAuE;IACvE,EAAE,CAAC,CAAC,UAAU,CAAC,QAAQ,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;QACjD,MAAM,CAAC,UAAU,CAAC;IACpB,CAAC;IAED,MAAM,sBAAsB,GAAe,CAAC,IAAkB,EAAE,EAAE;QAChE,EAAE,CAAC,CAAC,yBAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACxB,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACvC,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,uBAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC7B,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QACrC,CAAC;QAED,MAAM,CAAC,EAAE,CAAC,cAAc,CAAC,IAAI,EAAE,sBAAsB,EAAE,OAAO,CAAC,CAAC;IAClE,CAAC,CAAC;IAEF,MAAM,eAAe,GAAG,CAAC,IAAa,EAAW,EAAE,CACjD,gCAAoB,CAAC,IAAI,CAAC;QACxB,CAAC,CAAC,EAAE,CAAC,cAAc,CAAC,IAAI,EAAE,sBAAsB,EAAE,OAAO,CAAC;QAC1D,CAAC,CAAC,EAAE,CAAC,cAAc,CAAC,IAAI,EAAE,eAAe,EAAE,OAAO,CAAC,CAAC;IAExD,uDAAuD;IACvD,MAAM,aAAa,GAAkC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;IAExG,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,SAAS,CAAC,UAAU,EAAE,eAAe,CAAC,CAAC,CAAC;AAClE,CAAC,CAAC","sourcesContent":["import * as ts from 'typescript';\r\nimport { isComponentDecorator, isTemplateUrl, isStyleUrls } from './ng-ts-ast';\r\n\r\n/**\r\n * A transformer that updates the metadata for Angular `@Component({})` decorators.\r\n */\r\nexport type ComponentTransformer = {\r\n  /** TypeScript transformer to update the property assignment for `templateUrl: '..'`. */\r\n  templateUrl: ts.Transformer<ts.PropertyAssignment>;\r\n\r\n  /** TypeScript transformer to update the property assignment for `styleUrls: []`. */\r\n  styleUrls: ts.Transformer<ts.PropertyAssignment>;\r\n\r\n  /** TypeScript transformer to update the source file. */\r\n  file?: ts.Transformer<ts.SourceFile>;\r\n};\r\n\r\nexport const transformComponent: (\r\n  transformer: ComponentTransformer\r\n) => ts.TransformerFactory<ts.SourceFile> = transformer => context => sourceFile => {\r\n  // skip source files from 'node_modules' directory (third-party source)\r\n  if (sourceFile.fileName.includes('node_modules')) {\r\n    return sourceFile;\r\n  }\r\n\r\n  const visitComponentMetadata: ts.Visitor = (node: ts.Decorator) => {\r\n    if (isTemplateUrl(node)) {\r\n      return transformer.templateUrl(node);\r\n    } else if (isStyleUrls(node)) {\r\n      return transformer.styleUrls(node);\r\n    }\r\n\r\n    return ts.visitEachChild(node, visitComponentMetadata, context);\r\n  };\r\n\r\n  const visitDecorators = (node: ts.Node): ts.Node =>\r\n    isComponentDecorator(node)\r\n      ? ts.visitEachChild(node, visitComponentMetadata, context)\r\n      : ts.visitEachChild(node, visitDecorators, context);\r\n\r\n  // Either custom file transformer or identity transform\r\n  const transformFile: ts.Transformer<ts.SourceFile> = transformer.file ? transformer.file : file => file;\r\n\r\n  return transformFile(ts.visitNode(sourceFile, visitDecorators));\r\n};\r\n"]}