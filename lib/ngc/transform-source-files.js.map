{"version":3,"file":"transform-source-files.js","sourceRoot":"","sources":["../../../src/lib/ngc/transform-source-files.ts"],"names":[],"mappings":";;AAAA,4CAA4C;AAC5C,iCAAiC;AAGjC,gCAAmD,KAAU;IAC3D,MAAM,CAAC,KAAK,CAAC,WAAW,YAAY,KAAK,IAAI,OAAO,KAAK,CAAC,OAAO,KAAK,UAAU,CAAC;AACnF,CAAC;AAED,8BACE,MAAyD,EACzD,YAAoD;IAEpD,EAAE,CAAC,CAAC,sBAAsB,CAAgB,MAAM,CAAC,CAAC,CAAC,CAAC;QAClD,8EAA8E;QAC9E,MAAM,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,GAAG,MAAM,CAAC,WAAW,CAAC,EAAE,YAAY,CAAC,CAAC;IAC7D,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,2EAA2E;QAC3E,MAAM,QAAQ,GAAG,MAAM,CAAC;QAExB,MAAM,YAAY,GAAoB,EAAE,CAAC,kBAAkB,CAAC;YAC1D,OAAO,EAAE,QAAQ,CAAC,OAAO;SAC1B,CAAC,CAAC;QAEH,MAAM,OAAO,GAAe,EAAE,CAAC,aAAa,CAAC;YAC3C,SAAS,EAAE,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC;YAClC,OAAO,EAAE,QAAQ,CAAC,OAAO;YACzB,IAAI,EAAE,YAAY;SACnB,CAAC,CAAC;QAEH,MAAM,WAAW,GAAG,OAAO,CAAC,YAAY,EAAE,CAAC,cAAc,EAAE,CAAC;QAC5D,MAAM,oBAAoB,GAA2C,EAAE,CAAC,SAAS;QAC/E,0CAA0C;QAC1C,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,EACvB,YAAY,EACZ,QAAQ,CAAC,OAAO,CACjB,CAAC;QAEF,MAAM,CAAC,oBAAoB,CAAC;IAC9B,CAAC;AACH,CAAC;AA/BD,oDA+BC","sourcesContent":["import * as ng from '@angular/compiler-cli';\r\nimport * as ts from 'typescript';\r\nimport { TsConfig } from '../ts/tsconfig';\r\n\r\nfunction isTransformationResult<T extends ts.Node>(value: any): value is ts.TransformationResult<T> {\r\n  return value.transformed instanceof Array && typeof value.dispose === 'function';\r\n}\r\n\r\nexport function transformSourceFiles(\r\n  source: TsConfig | ts.TransformationResult<ts.SourceFile>,\r\n  transformers: ts.TransformerFactory<ts.SourceFile>[]\r\n): ts.TransformationResult<ts.SourceFile> {\r\n  if (isTransformationResult<ts.SourceFile>(source)) {\r\n    // Apply subsequent typescript transformation to previous TransformationResult\r\n    return ts.transform([...source.transformed], transformers);\r\n  } else {\r\n    // Apply initial typescript transformation to initial sources from TsConfig\r\n    const tsConfig = source;\r\n\r\n    const compilerHost: ng.CompilerHost = ng.createCompilerHost({\r\n      options: tsConfig.options\r\n    });\r\n\r\n    const program: ng.Program = ng.createProgram({\r\n      rootNames: [...tsConfig.rootNames],\r\n      options: tsConfig.options,\r\n      host: compilerHost\r\n    });\r\n\r\n    const sourceFiles = program.getTsProgram().getSourceFiles();\r\n    const transformationResult: ts.TransformationResult<ts.SourceFile> = ts.transform(\r\n      // XX: circumvent tsc compile error in 2.6\r\n      Array.from(sourceFiles),\r\n      transformers,\r\n      tsConfig.options\r\n    );\r\n\r\n    return transformationResult;\r\n  }\r\n}\r\n"]}